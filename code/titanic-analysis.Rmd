---
title: 'Pràctica 2: Neteja i anàlisi de les dades'
author: 'Adrián Alonso Gonzalo i Alexandre Vidal De Palol'
date: "Maig/Juny 2022"
output:
  pdf_document:
    latex_engine: xelatex
    highlight: zenburn
    toc: yes
    number_sections: true
  html_document:
    highlight: default
    number_sections: yes
    theme: cosmo
    toc: yes
    toc_depth: 2
  word_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(eval=T, echo=T)
```


# Descripció i càrrega del dataset.

El conjunt de dades train.csv s'ha obtingut del web https://www.kaggle.com/c/titanic.

Aquest conjunt de dades conté informació sobre la tripulació del Titanic amb 12 tipus de variables i un total de 891 registres ( passatgers).

Les variables d’aquesta mostra son:

- PassengerId: Numero de passatger.
- Survived: Supervivència (0=No, 1=Si).
- Pclass: Classe de tiquet (1=Primera, 2=Segona, 3=Tercera) .
- Name: Nom.
- Sex: Sexe.
- Age: Edat.
- SibSp: Germans / Cónjugues a bord del Titanic.
- Parch: Pares / nens a bord del Titanic.
- Ticket: Número de ticket.
- Fare: Preu del ticket.
- Cabin: Numero de cabina.
- Embarked: Port de embarcament.

Lectura del fitxer.

```{r message= FALSE, warning=FALSE}

# Carreguem els fitxers 'test.csv' i 'train.csv' de la carpeta 'data/input' (indicant que volem els 'strings' com 'factors')
test_dataset <- read.csv("../data/input/test.csv", stringsAsFactors=TRUE)
train_dataset <- read.csv("../data/input/train.csv", stringsAsFactors=TRUE)

# Mostrem les primeres files dels jocs de dades
head(test_dataset)
head(train_dataset)

# Creem una nova columna amb el nom del dataset del qual provenen les files
test_dataset['row_type'] <- as.factor('test')
train_dataset['row_type'] <- as.factor('train')

# Creem la columna 'Survived' ja que el joc de dades de test no la conté (introduïrem un valor dummy que després eliminarem)
test_dataset['Survived'] <- 99

# Juntem els dos jocs de dades en un únic dataset per poder netejar els dos a la vegada
dataset <- rbind(train_dataset, test_dataset[,colnames(train_dataset)])

# Mostrem les primeres files del dataset unificat
head(dataset)

# Mostrem l'estructura del dataset
str(dataset)

# Mostrem un resum de les estadistiques de les columnes del dataset
summary(dataset)

# Mostrem el número de files del joc de dades unificat i per separat
dim(dataset)[1]
dim(dataset[dataset$row_type=='test',])[1]
dim(dataset[dataset$row_type=='train',])[1]

```

Observem que que el dataset conté 3 tipus de variables del quals caràcter, numèric i enter.

# Integració i selecció de les dades d’interès a analitzar.


El procés d'integració i selecció de les dades es realitzarà al llarg del procés de neteja
i anàlisi de les diverses variables del conjunt de dades d'entrenament del dataset.

En aquest procés es pretén anar analitzant les diferents variables en el procés de neteja i anàlisi, i en
funció de les característiques que es vagin observant de les diverses variables es prendrà la decisió d'utilitzar un conjunt
seleccionat el qual pugui ser útil per a la predicció del model i la comprovació amb el conjunt de test o validació.

El resultat del projecte pot respondre a possibles causes de mort dels tripulants que no van sobreviure a la tragèdia del Titanic, permetent
establir models d'inferència sobre les causes relatives a la mortalitat entre diversos tipus de passatgers.
Per altra banda la implementació de un model d'interès sobre quines han sigut variables que han influït més o menys en la supervivència del naufragi.

```{r message= FALSE, warning=FALSE}

View(dataset)

```


# Neteja de dades.

## Valors buits (missing values).

Ajust de les dades amb valors nuls o perduts

```{r message= FALSE, warning=FALSE}
# transformació de les variables 

apply(dataset=="",2, sum)
apply(is.na(dataset),2, sum)
```
Observem que les variables amb valors són Age, Cabin i Embarked

Ajust del la variable Age

```{r message= FALSE, warning=FALSE}
library(mice)
dataset <- as.data.frame(dataset)
#imputem els valors de edat que falten amb el paquet MICE
impute <- mice(dataset[, !names(dataset) %in% c('PassengerId','Name','Ticket','Cabin','Survived','Assigned','FL','FT','ticketlength','one','two','three','four','five','six','seven')], rfPackage = "randomForest")
trained_mouse <- complete(impute)
```

```{r pplot, echo = FALSE, warning = FALSE}
#creem histogramas per observar si els valors imputats a la variable Age mostren gaire diferència

library("ggplot2")
ap <- ggplot(dataset, aes(x=Age))+geom_density(adjust=.5)+labs(title="Original Data")
ap
mp <- ggplot(trained_mouse, aes(x=Age))+geom_density(adjust=.5)+labs(title="Imputed Data")
mp
```
Observem que els dos gràfics són reonablament semblants, pertant procedim a reempleçar les dades dels valors imputats als originals

```{r message= FALSE, warning=FALSE}
dataset$Age <- trained_mouse$Age
```


Ajustem els valors perduts de la variable Embarked

Com hem vist anteriorment hi ha dos valors de la variable Embarked que falten. Procedim a verificar amb el valor de la variable Cabin. A partir de les dades, totes les cabines que comencen amb B es van embarcar des de Southampton o Charbourg.

```{r message= FALSE, warning=FALSE}
unique(dataset[grep("*^B", dataset$Cabin),]$Embarked)
```
Els bitllets de viatge de tipus B costen al voltant de 80 USD, que és molt similar a la tarifa mitja o mitjana dels passatgers S.

```{r cab, echo = FALSE, message=FALSE}
library(magrittr)
library(dplyr)

dataset[grep("*^B", dataset$Cabin),] %>% group_by(Embarked) %>% summarize_each(funs(mean),Fare)
dataset[grep("*^B", dataset$Cabin),] %>% group_by(Embarked) %>% summarize_each(funs(median),Fare)
```

Per tant, procedim a imputar els dos valors perduts de "Embarked" com a tipus S

```{r replace}
dataset$Embarked[c(62, 830)] <- 'S'
```


Busquem  on està localitzat el valor perdut de la variable "Fare"

```{r replace}
which(is.na(dataset$Fare))
```
Trobem la mitjana del total dels tiquets excloent el valor perdut

```{r replace}
mean(dataset$Fare, na.rm = TRUE)
```
Imputem el el valor obtingut al valor perdut de la columna "fare"

```{r replace}
dataset$Fare[c(1044)] <- 33.29548
```

Observem que ja no tenim valors perduts en cap registre

```{r message= FALSE, warning=FALSE}
# transformació de les variables 

apply(is.na(dataset),2, sum)
```


## Valors extrems (outliers).

```{r message= FALSE, warning=FALSE}

# Placeholder

```

## Altres accions per a la neteja del joc de dades.

Primerament, observem que la primera variable "PassengerId" no és res més que un identificador, per tant procedim a eliminar-la del conjunt de dades ja que no ens interessa per l'estudi.

```{r message= FALSE, warning=FALSE}

# eliminació de la primera columna PassengerId
dataset <- dataset[,-1]

```

Observem que les variables 'Survived' i 'Pclass' són de tipus enter, però la seva funció es indicar una categoria. Per tant, procedim a convertir-les en tipu factor.

```{r message= FALSE, warning=FALSE}

# transformació de les variables 

dataset$Survived <- as.factor(dataset$Survived)
class(dataset$Survived)

dataset$Pclass <- as.factor(dataset$Pclass)
class(dataset$Pclass)

```


# Anàlisi de les dades.

## Selecció de grups a analitzar/comparar.

```{r message= FALSE, warning=FALSE}

# Placeholder

```

## Normalitat i homogeneïtat de la variància.

```{r message= FALSE, warning=FALSE}

# Placeholder

```

## Aplicació de proves estadístiques per a la comparació de grups.

```{r message= FALSE, warning=FALSE}

# Placeholder

```


# Representació de resultats (taules i gràfiques).

```{r message= FALSE, warning=FALSE}

# Placeholder

```


# Conclusions.

 
